version: '3.8'

services:
  signaling-server:
    build: 
      context: .
      dockerfile: Dockerfile.signaling
    ports:
      - "8777:8777"
    environment:
      - ADDR=8777
    networks:
      - webrtc-network
    restart: unless-stopped

  media-server:
    build: 
      context: .
      dockerfile: Dockerfile.media
    ports:
      - "8888:8888"   # HTTP API
      - "8554:8554"   # RTSP
      - "10000-20000:10000-20000/udp"  # RTP ports
    environment:
      - SIGNALING_ADDR=signaling-server:8777
      - MEDIA_ADDR=:8888
      - RTSP_PORT=8554
      - STUN_SERVER=stun:stun.l.google.com:19302
    depends_on:
      - signaling-server
    networks:
      - webrtc-network
    restart: unless-stopped
    volumes:
      - /dev/shm:/dev/shm 

networks:
  webrtc-network:
    driver: bridge